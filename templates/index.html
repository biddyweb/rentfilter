<!DOCTYPE HTML>
<html>
    <head>
        <title>Ареда квартир от хозяина</title>       
        <link href='http://fonts.googleapis.com/css?family=PT+Sans:regular,bold' rel='stylesheet' type='text/css'>
        <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.3.0/build/cssreset/reset-min.css">
        <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.3.0/build/cssfonts/fonts-min.css">
        <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.3.0/build/cssbase/base-context-min.css">
        <link type="text/css" rel="stylesheet" media="all" href="/css/style.css?10" />
    </head>
    <body>  
        <div id="header">
            <div>
                <a href="/" class='logo'><span class='first'>Rent</span><span class='second'>Filter</span></a>

                <div class="social">
                    <a href="http://vkontakte.ru/rentfilter" class="vkontakte">Вконтакте</a>
                    <a href="http://www.facebook.com/pages/RentFilter/202459219787387" class="facebook">Facebook</a>
                    <a href="http://twitter.com/rentfilter" class="twitter">Twitter</a>
                </div>                        
            </div>
        </div>
        <div id="about">
            <div>
                <h1>Снимите квартиру<div>без помощи риэлторов</div></h1>
                <p class='desc'>
                Не хотите платить агентам по недвижимости комиссию? RentFilter поможет снять квартиру без посредников. Наши роботы фильтруют объявления об аренде помещений и оставляют только те, которые подают сами хозяева квартир.
                </p>
                <div class='images' style='display: none'><div></div></div>
                <div id='thanks'>Сказать "Спасибо"</div>
            </div>
        </div>
        <div id="wrapper">            
            {% if admin %}
            <form action="/admin/agent_phones" method="POST" style="text-align: left">
                <label>Телефоны риэлторов</label>
                <br/>
                <input placeholder="Причина" name="source" type="text" />
                <br/>
                <textarea name="phones" style="width: 600px; height: 200px;"></textarea>
                <br/>
                <input type="submit" />
            </form>
            {% endif %}
            <div class="relative">
                <div id="left">
                    <div id="left_header">
                        <div class="select_town">
                            <span class='name'>Санкт-Петербург</span>
                            <span class='arrow'>▾</span>

                            <ul class="towns" style="display: none">
                                <li>Другой город</li>
                            </ul>
                        </div>
                    </div>
                    <ul class="ads">
                        {% include 'ads.html' %} 
                        <li class="load_more"><a data-cursor='{{cursor}}'>Загрузить еще</a></li>
                    </ul>
                </div>
                <div id="right">
                    <div class='links'>
                        <span class='title'>Как снять квартиру от хозяина?</span> 
                        <ol>
                            <li><a href="#">Найти объявление</a></li>
                            <li><a href="#">Связаться с хозяином</a></li>
                            <li><a href="#">Изучить документы на квартиру</a></li>
                            <li><a href="#">Подсать договор</a></li>
                        </ol>
                        <div class="title" style="margin-top: 50px; font-size: 14px;">Карта города</div>
                        <a href="http://goo.gl/maps/AYKn" target="_blank" class='map'><img src='/images/spb_map.png'/></a>
                        <div class="title" style="margin-top: 50px; font-size: 14px;">Карта метро</div>
                        <a href="http://metro.yandex.ru/spb/" target="_blank" class='map'><img src='http://yandex.st//metro-data/maps/spb.gif?1.0.17' /></a>

                    </div>
                </div>
            </div>
            <div class="clear"></div>
        </div>
        <div id="footer">
            <h3>Следите за нами в социальных сетях</h3>
            <div class="widgets">
                <div id="vkontakte">
                    <script type="text/javascript" src="http://userapi.com/js/api/openapi.js?25"></script>

                    <!-- VK Widget -->
                    <div id="vk_groups"></div>
                    <script type="text/javascript">
                    VK.Widgets.Group("vk_groups", {mode: 0, width: "400", height: "250"}, 26047335);
                    </script>
                </div>
                <div id="twitter">
                    <a href="http://twitter.com/share" class="twitter-share-button" data-count="vertical" data-via="rentfilter">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>
                </div>
                <div id="facebook">
                    <iframe src="http://www.facebook.com/plugins/likebox.php?href=http%3A%2F%2Fwww.facebook.com%2Fpages%2FRentFilter%2F202459219787387&amp;width=400&amp;colorscheme=light&amp;show_faces=true&amp;stream=false&amp;header=true&amp;height=250" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:400px; height:250px;" allowTransparency="true"></iframe>
                </div>
                <div class="shower">
                    <div></div>
                </div>
                <div class="about_us" name="about">
                    <h3>О проекте</h3>
                    <p>Зайдя на любой сайт с объявлениями об аренде квартир, вам придется позвонить не по одному десятку номеров, прежде чем найти объявление действительно от владельца квартиры, а не от риэлторского агентства. Но и это может случиться, только если вам очень повезет.</p>
                    <p>RentFilter поможет снять квартиру без посредников. Наши роботы фильтруют объявления об аренде помещений и оставляют только те, которые подают сами хозяева квартир.</p>
                    <p style="white-space:nowrap;">Если у вас возникли вопросы пишите нам <a href="http://rentfilter.copiny.com/">сюда</a> или на почту <a href='mailto:contacts@rentfilter.ru'>contacts@rentfilter.ru</a></p>
                    <br/>
                    <br/>
                    <br/>
                    <p>
                        <a href="javascript:;" class='move_up'>Вверх!</a>                                                
                        <span class="api">А еще у нас есть <a href="/api">API</a></span>
                    </p>
                </div>
            </div>
            <div class="clear admin_links">
                {% if admin %}
                <a href="{{logout_url}}">Выйти</a>
                {% else %}
                <a href="{{login_url}}">Вход для администраторов</a>
                {% endif %}
            </div>
        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.2/jquery.min.js"></script>
        <script src="/js/images.js"></script>
        <script src="/js/scale.raphael.js"></script>
        <script src="/js/raphael-min.js"></script>
        <script src="/js/jquery.tooltip.min.js"></script>        
        <script src="/js/jquery.sap.min.js"></script>        
        <script>
            $('.load_more a').bind('click', function(){
                var self = this;
                var cursor = $(this).data('cursor');

                $.getJSON('/', {cursor: cursor }, 
                    function(data){
                        if (data.html.length <= 1) {
                            return $(self.parentNode).hide();
                        }

                        $(self).data('cursor', data.cursor);
                        
                        var latest_time = $(self.parentNode).prevAll('li.time').find('span')[0].innerHTML;
                        
                        var temp = $("<div/>").append(data.html);
                        var first_time = temp.find('li.time:first');
                        if (first_time.find('span')[0].innerHTML == latest_time) {
                            first_time.prev().remove();
                            first_time.remove();
                        }

                        console.log(temp);

                        $(self.parentNode).before(temp[0].innerHTML);
                    }                    
                );
            });

            $('.about_link').bind('click', function(){
                window.scrollTo(0, document.body.scrollHeight);
            });

            $('.move_up').bind('click', function(){
                window.scrollTo(0, 0);
            });

            $('.ads li').tooltip({ delay: 500 });

            $('.select_town').live('click', function(){
                $(this).find('.towns').toggle();
                $(this).toggleClass('opened');
            });

            function renderSVG(context, name, options) {
                if (!options)
                    options = {};

                var set = context.set();
                for (var i=0; i<images[name].length; i++) {
                    try {
                        set.push(context.path(images[name][i]));
                    } catch (e) {}
                }

                set.attr({fill: "#403B33", stroke: "none"}).attr(options);
                
                return set;
            }

            $('#about .images').show();
            
            var animations = [['head', -70], ['phone', -20], ['arrive', -110], ['donate', -20]];
            var container = $('#about .images div')[0];
            var main = new ScaleRaphael(container, 500, 500);
            main.scaleAll(3.8);

            function animate(frame) {
                if (frame >= animations.length) {
                    frame = 0;
                }

                $(container).parent().css({right: animations[frame][1]});
                $(container).fadeIn('slow');

                main.clear();
                renderSVG(main, animations[frame][0]);                
                
                $(container).delay(2000).fadeOut('slow', function(){                    
                    animate(frame+1);
                });                
            }

            animate(0);

            var shower = new ScaleRaphael($('.shower div')[0], 400, 400);                         
            shower.scaleAll(3);
            var set = renderSVG(shower, 'shower', {fill:"white"});            

            var animate_shower = true;
            set[0].node.onclick = function(){
                if (animate_shower) {
                    animate_shower = false;
                    set.show();
                } else {
                    animate_shower = true;
                }
            }

            var lines = [[8,7,6,5,4,3], [14,13,12,11,10,9], [20,19,18,17,16,15], [21,22,23,24,25,26]];

            for (var j=0; j<lines.length; j++) {
                (function(items){
                    var active_index = 0;
                    function animateShower(indexes){
                        if (animate_shower) {
                            if (active_index > indexes.length) {
                                active_index = 0;
                            }

                            for(var i=0; i<indexes.length; i++) {
                                set[indexes[i]].show();

                                if (active_index == i) {
                                    set[indexes[i]].hide();
                                }
                            }
                            
                            active_index += 1;

                        }
                        
                        setTimeout(function(){
                            animateShower(indexes);
                        }, 50);
                    }
                    
                    setTimeout(function(){
                        animateShower(items);
                    }, Math.floor(Math.random()*1000));
                }(lines[j]));
            }
        </script>
    </body>
</html>
